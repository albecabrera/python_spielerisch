<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Python Lernen - Roblox Style</title>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.12.0/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.12.0/brython_stdlib.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #111217 0%, #191b23 100%);
            color: #ffffff;
            overflow-x: hidden;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        @keyframes unlock {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(20deg); opacity: 0.5; }
            100% { transform: scale(0) rotate(40deg); opacity: 0; }
        }

        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .top-bar {
            background: linear-gradient(to bottom, #2b2d33, #1f2024);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3a3c42;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .roblox-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #00a2ff 0%, #0066cc 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(0, 162, 255, 0.4);
        }
        
        .player-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .robux-display {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #00a2ff 0%, #0066cc 100%);
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0, 162, 255, 0.3);
            animation: pulse 2s infinite;
        }
        
        .robux-icon {
            width: 24px;
            height: 24px;
            background: #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #0066cc;
        }
        
        .level-badge {
            background: linear-gradient(135deg, #ff6b00 0%, #ff3d00 100%);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
        }
        
        .main-container {
            display: flex;
            height: calc(100vh - 55px);
        }
        
        .explorer-panel {
            width: 280px;
            background: #1f2024;
            border-right: 1px solid #3a3c42;
            overflow-y: auto;
        }
        
        .panel-header {
            background: #2b2d33;
            padding: 10px 15px;
            font-size: 13px;
            font-weight: 600;
            border-bottom: 1px solid #3a3c42;
        }
        
        .lesson-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #3a3c42;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lesson-item:hover {
            background: rgba(0, 162, 255, 0.1);
        }

        .lesson-item.active {
            background: rgba(0, 162, 255, 0.2);
            border-left: 3px solid #00a2ff;
        }

        .lesson-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255, 0, 0, 0.05);
        }

        .lesson-item.locked:hover {
            background: rgba(255, 0, 0, 0.05);
        }

        .lesson-lock {
            font-size: 18px;
            animation: shake 0.8s infinite;
        }

        .lesson-item.completed {
            border-left: 3px solid #4ade80;
        }

        .lesson-checkmark {
            color: #4ade80;
            font-size: 18px;
            animation: bounceIn 0.5s;
        }

        .lesson-title-text {
            flex: 1;
        }
        
        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }
        
        .lesson-card {
            background: #2b2d33;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .lesson-title {
            font-size: 24px;
            color: #00a2ff;
            margin-bottom: 15px;
        }
        
        .code-editor {
            width: 100%;
            min-height: 200px;
            background: #111217;
            color: #e5e7eb;
            border: 1px solid #3a3c42;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        .editor-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .editor-btn {
            background: linear-gradient(135deg, #00a2ff 0%, #0066cc 100%);
            color: #ffffff;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .editor-btn:hover {
            transform: translateY(-2px);
        }
        
        .editor-btn.submit {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }
        
        .output-panel {
            background: #0f1014;
            border: 1px solid #3a3c42;
            border-radius: 8px;
            padding: 15px;
            min-height: 100px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            color: #a8e063;
            white-space: pre-wrap;
        }
        
        .output-error {
            color: #ff6b9d;
        }
        
        .feedback-box {
            margin: 20px 0;
            padding: 15px 20px;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        .feedback-box.success {
            background: rgba(74, 222, 128, 0.2);
            border-left: 4px solid #4ade80;
        }
        
        .feedback-box.error {
            background: rgba(248, 113, 113, 0.2);
            border-left: 4px solid #f87171;
        }
        
        .roblox-mascot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2b2d33 0%, #1f2024 100%);
            border: 2px solid #00a2ff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 162, 255, 0.4);
            z-index: 1000;
            max-width: 300px;
            animation: bounceIn 0.5s;
        }

        .mascot-character {
            font-size: 60px;
            text-align: center;
            animation: float 2s infinite;
            margin-bottom: 10px;
        }

        .mascot-message {
            font-size: 14px;
            line-height: 1.6;
            color: #ffffff;
            text-align: center;
        }

        .mascot-close {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            color: #888;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        .mascot-close:hover {
            color: #ffffff;
        }

        .unlock-animation {
            animation: unlock 0.5s forwards;
        }

        .hint-box {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .hint-box h4 {
            color: #ffc107;
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .hint-box p {
            color: #ffffff;
            margin: 0;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .roblox-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #2b2d33 0%, #1f2024 100%);
            border: 3px solid #4ade80;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(74, 222, 128, 0.6);
            z-index: 2000;
            animation: celebrationBounce 0.6s forwards;
            max-width: 400px;
        }

        @keyframes celebrationBounce {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .success-character {
            font-size: 80px;
            text-align: center;
            animation: float 1.5s infinite;
            margin-bottom: 15px;
        }

        .speech-bubble {
            position: relative;
            background: #4ade80;
            color: #1f2024;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 16px;
            line-height: 1.5;
            text-align: center;
            margin-bottom: 15px;
        }

        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #4ade80;
        }

        .success-reward {
            text-align: center;
            color: #ffc107;
            font-size: 18px;
            font-weight: 700;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2024; }
        ::-webkit-scrollbar-thumb { background: #3a3c42; border-radius: 4px; }
    </style>
</head>
<body onload="brython()">
    <div class="top-bar">
        <div class="roblox-logo">
            <div class="logo-icon">üêç</div>
            <span>Python Lernen - Roblox Style</span>
        </div>
        <div class="player-stats">
            <div class="level-badge">
                <span>‚≠ê Level <span id="playerLevel">1</span></span>
            </div>
            <div class="robux-display">
                <div class="robux-icon">R$</div>
                <span id="robuxCount">0</span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="explorer-panel">
            <div class="panel-header">üìö Lernwelten</div>
            <div id="lessonList"></div>
        </div>

        <div class="workspace">
            <div class="content-area" id="contentArea">
                <!-- Content wird dynamisch geladen -->
            </div>
        </div>
    </div>

    <!-- Roblox Mascot -->
    <div id="robloxMascot" style="display: none;"></div>

    <script type="text/python">
from browser import document, window, html
import sys
from io import StringIO
import traceback

# Spieler-Daten
player_data = {
    'robux': 0,
    'level': 1,
    'completed': set(),
    'unlocked': {'lesson1'}  # Nur die erste Lektion ist freigeschaltet
}

# Motivierende Nachrichten der Maskottchen
MASCOT_MESSAGES = [
    "Unglaublich! üéâ Du hast die n√§chste Lektion freigeschaltet!",
    "Du bist ein Crack! üöÄ N√§chstes Level freigeschaltet!",
    "Genial! ‚≠ê Das Schloss ist offen!",
    "Fantastisch! üí™ Weiter so!",
    "Exzellente Arbeit! üéÆ Neue Lektion verf√ºgbar!",
    "Geschafft! üèÜ Dein Abenteuer geht weiter!",
    "Perfekt! ‚ú® Der Weg geht weiter!",
    "Bravo! üåü Du hast das Schloss ge√∂ffnet!"
]

# Kluge Ausdr√ºcke f√ºr erfolgreiche L√∂sungen
SMART_QUOTES = [
    "Programmieren ist wie Magie - nur mit mehr Logik! ‚ú®",
    "Code ist Poesie f√ºr Computer! üíª",
    "Ein Programmierer ist ein Probleml√∂ser! üß†",
    "Fehler sind nur Lernchancen verkleidet! üéØ",
    "Von null auf Held - ein print() nach dem anderen! üöÄ",
    "Du bist auf dem Weg zum Python-Meister! üêç",
    "Jede Codezeile bringt dich weiter! üí™",
    "Debugging ist wie Detektivarbeit! üîç",
    "Clean Code ist gl√ºcklicher Code! üòä",
    "Du denkst schon wie ein Programmierer! üéÆ"
]

# Lektionsdaten
LESSONS = {
    'lesson1': {
        'title': 'Dein erstes Programm',
        'world': 1,
        'reward': 100,
        'task': 'Schreibe 3 verschiedene print()-Befehle.',
        'hint': 'Mit print() kannst du Text ausgeben. Beispiel: print("Hallo")\nSchreibe 3 verschiedene print()-Zeilen mit unterschiedlichen Texten.',
        'starter': '''print("Hallo Welt!")
print("Ich lerne Python!")
print("Das macht Spa√ü!")''',
        'check': lambda code, output: code.count("print(") >= 3
    },
    'lesson2': {
        'title': 'Variablen & Datentypen',
        'world': 1,
        'reward': 150,
        'task': 'Erstelle 3 Variablen und gib sie aus.',
        'hint': 'Variablen speichern Werte. Beispiel: name = "Max"\nErstelle 3 Variablen (Text und Zahlen) und gib sie mit print() aus.',
        'starter': '''name = "Max"
alter = 14

print("Name:", name)
print("Alter:", alter)''',
        'check': lambda code, output: code.count("=") >= 3 and code.count("print(") >= 3
    },
    'lesson3': {
        'title': 'Rechnen mit Python',
        'world': 1,
        'reward': 150,
        'task': 'Benutze Python als Taschenrechner.',
        'hint': 'Operatoren: + (plus), - (minus), * (mal), / (geteilt)\nBeispiel: summe = 10 + 5\nErstelle Variablen und berechne damit.',
        'starter': '''a = 10
b = 5
summe = a + b
print("Summe:", summe)''',
        'check': lambda code, output: "+" in code or "*" in code
    },
    'lesson4': {
        'title': 'Strings & Text',
        'world': 1,
        'reward': 200,
        'task': 'Kombiniere Text und Variablen mit f-Strings.',
        'hint': 'f-String Format: f"Text {variable} mehr Text"\nBeispiel: print(f"Hallo {name}")\nSchreibe einen Satz √ºber dich.',
        'starter': '''name = "Alex"
alter = 15
print(f"Ich bin {name} und {alter} Jahre alt")''',
        'check': lambda code, output: "f\"" in code or "f'" in code
    },
    'lesson5': {
        'title': 'Listen & Sammlungen',
        'world': 1,
        'reward': 200,
        'task': 'Arbeite mit Listen und f√ºge Elemente hinzu.',
        'hint': 'Liste erstellen: meine_liste = ["Element1", "Element2"]\nElement hinzuf√ºgen: meine_liste.append("Neues")\nNutze .append() um Elemente hinzuzuf√ºgen.',
        'starter': '''fruechte = ["Apfel", "Banane"]
fruechte.append("Orange")
print(fruechte)''',
        'check': lambda code, output: "append(" in code
    },
    'lesson6': {
        'title': 'if/else Entscheidungen',
        'world': 2,
        'reward': 250,
        'task': 'Triff Entscheidungen mit if/else.',
        'hint': 'Vergleiche: == (gleich), > (gr√∂√üer), < (kleiner), >= (gr√∂√üer gleich)\nBeispiel: if alter >= 18:\nSchreibe eine if/else Bedingung.',
        'starter': '''alter = 15
if alter >= 18:
    print("Erwachsen")
else:
    print("Jugendlich")''',
        'check': lambda code, output: "if" in code and "else" in code
    },
    'lesson7': {
        'title': 'Schleifen (for/while)',
        'world': 2,
        'reward': 300,
        'task': 'Wiederhole Aktionen mit einer for-Schleife.',
        'hint': 'for-Schleife: for variable in range(start, ende):\nBeispiel: for i in range(1, 6):\nrange(1, 6) erzeugt die Zahlen 1, 2, 3, 4, 5',
        'starter': '''for i in range(1, 6):
    print(f"Zahl: {i}")''',
        'check': lambda code, output: "for" in code and "range(" in code
    },
    'lesson8': {
        'title': 'Funktionen erstellen',
        'world': 2,
        'reward': 300,
        'task': 'Erstelle eigene Funktionen.',
        'hint': 'Syntax: def funktionsname(parameter):\nAufruf: funktionsname("Wert")\nFunktionen k√∂nnen mehrmals aufgerufen werden.',
        'starter': '''def gruesse(name):
    print(f"Hallo {name}!")

gruesse("Max")''',
        'check': lambda code, output: "def " in code and "return" in code or "def " in code
    },
    'lesson9': {
        'title': 'Module & Bibliotheken',
        'world': 2,
        'reward': 250,
        'task': 'Benutze das random-Modul.',
        'hint': 'Module importieren: import random\nZufallszahl: random.randint(start, ende)\nBeispiel: random.randint(1, 10)',
        'starter': '''import random
zahl = random.randint(1, 10)
print("Zufallszahl:", zahl)''',
        'check': lambda code, output: "import" in code
    },
    'lesson10': {
        'title': 'Klassen & Objekte',
        'world': 3,
        'reward': 400,
        'task': 'Erstelle eine Klasse mit Eigenschaften und Methoden.',
        'hint': 'class Klassenname:\n    def __init__(self, parameter):\n        self.eigenschaft = parameter\n    def methode(self):\n        print("Etwas")\nObjekt erstellen: obj = Klassenname("Wert")',
        'starter': '''class Hund:
    def __init__(self, name):
        self.name = name

    def bellen(self):
        print(f"{self.name} bellt!")

mein_hund = Hund("Rex")
mein_hund.bellen()''',
        'check': lambda code, output: "class " in code and "__init__" in code
    },
    'lesson11': {
        'title': 'Dateien lesen/schreiben',
        'world': 3,
        'reward': 350,
        'task': 'Simuliere das Arbeiten mit Dateien.',
        'hint': 'In normalem Python: with open("datei.txt", "w") as f:\nHier in Brython: Simuliere was gespeichert w√ºrde.\nZeige mit print() was in einer Datei stehen w√ºrde.',
        'starter': '''dateiname = "meine_notizen.txt"
inhalt = "Das ist mein Text"

print(f"W√ºrde '{inhalt}' in {dateiname} speichern")''',
        'check': lambda code, output: len(code) > 10
    },
    'lesson12': {
        'title': 'Eigene Spiele bauen',
        'world': 3,
        'reward': 500,
        'task': 'Baue ein Spiel mit allem was du gelernt hast!',
        'hint': 'Kombiniere: random, Variablen, if/else, Schleifen, Funktionen\nBeispiel-Spiel: Zahlenraten\nErstelle eine Zufallszahl und vergleiche sie mit einer Eingabe.',
        'starter': '''import random

zahl = random.randint(1, 10)
print(f"Rate die Zahl zwischen 1-10!")
print(f"Die Zahl war: {zahl}")''',
        'check': lambda code, output: "import random" in code
    },

}

current_lesson = 'lesson1'

def play_success_sound():
    window.eval('''
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.value = 800;
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start(audioCtx.currentTime);
        osc.stop(audioCtx.currentTime + 0.5);
    ''')

def add_robux(amount):
    player_data['robux'] += amount
    document['robuxCount'].text = str(player_data['robux'])
    play_success_sound()

def show_mascot(message, character="üéÆ"):
    """Zeigt das Roblox-Maskottchen mit motivierender Nachricht"""
    import random
    mascot_div = document['robloxMascot']

    mascot_div.html = f'''
        <div class="roblox-mascot">
            <button class="mascot-close" onclick="hideMascot()">√ó</button>
            <div class="mascot-character">{character}</div>
            <div class="mascot-message">{message}</div>
        </div>
    '''
    mascot_div.style.display = 'block'

    # Auto-verstecken nach 5 Sekunden
    window.setTimeout(lambda: hide_mascot(), 5000)

def hide_mascot():
    """Versteckt das Maskottchen"""
    mascot_div = document['robloxMascot']
    mascot_div.style.display = 'none'

def toggle_hint():
    """Zeigt/Versteckt den Hinweis"""
    hint_box = document['hintBox']
    if hint_box.style.display == 'none' or hint_box.style.display == '':
        hint_box.style.display = 'block'
    else:
        hint_box.style.display = 'none'

def show_success_character(smart_quote, reward):
    """Zeigt eine Roblox-Figur mit Sprechblase bei erfolgreicher L√∂sung"""
    import random

    characters = ["üéÆ", "üéØ", "‚≠ê", "üèÜ", "üöÄ", "üíé", "üëæ", "üé™"]
    character = random.choice(characters)

    success_div = document['robloxMascot']
    success_div.html = f'''
        <div class="roblox-success">
            <div class="success-character">{character}</div>
            <div class="speech-bubble">{smart_quote}</div>
            <div class="success-reward">+{reward} Robux verdient! ü™ô</div>
        </div>
    '''
    success_div.style.display = 'block'

    # Auto-verstecken nach 5 Sekunden
    window.setTimeout(lambda: hide_mascot(), 5000)

def get_lesson_number(lesson_id):
    """Holt die Lektionsnummer aus der ID"""
    return int(lesson_id.replace('lesson', ''))

def get_next_lesson_id(lesson_id):
    """Holt die ID der n√§chsten Lektion"""
    current_num = get_lesson_number(lesson_id)
    next_num = current_num + 1
    next_id = f'lesson{next_num}'
    return next_id if next_id in LESSONS else None

def unlock_lesson(lesson_id):
    """Schaltet eine Lektion frei und zeigt Animation"""
    player_data['unlocked'].add(lesson_id)

    # Schloss visuell aktualisieren
    try:
        lesson_elem = document[f'lesson_{lesson_id}']
        lesson_elem.classList.remove('locked')

        # Schloss suchen und animieren
        lock_span = lesson_elem.select('.lesson-lock')
        if lock_span:
            lock_span[0].classList.add('unlock-animation')
            # Schloss nach Animation entfernen
            window.setTimeout(lambda: update_lesson_icons(), 500)
    except:
        pass

def update_lesson_icons():
    """Aktualisiert die Icons aller Lektionen"""
    for lesson_id in LESSONS.keys():
        try:
            lesson_elem = document[f'lesson_{lesson_id}']
            # Vorhandene Icons entfernen
            for icon in lesson_elem.select('.lesson-lock, .lesson-checkmark'):
                icon.remove()

            # Passendes Icon hinzuf√ºgen
            if lesson_id in player_data['completed']:
                lesson_elem.classList.add('completed')
                lesson_elem.classList.remove('locked')
                checkmark = html.SPAN('‚úì', Class='lesson-checkmark')
                lesson_elem <= checkmark
            elif lesson_id not in player_data['unlocked']:
                lesson_elem.classList.add('locked')
                lock = html.SPAN('üîí', Class='lesson-lock')
                lesson_elem <= lock
        except:
            pass

def load_lesson(lesson_id):
    global current_lesson
    if lesson_id not in LESSONS:
        return

    # √úberpr√ºfen ob die Lektion freigeschaltet ist (Escape Room System)
    if lesson_id not in player_data['unlocked']:
        show_mascot("üîí Diese Lektion ist noch gesperrt! L√∂se zuerst die vorherigen Lektionen.", "üîê")
        return

    current_lesson = lesson_id
    lesson = LESSONS[lesson_id]

    content = f'''
        <div class="lesson-card">
            <h2 class="lesson-title">üéÆ {lesson['title']}</h2>
            <p style="color: #b4b7c2; margin-bottom: 20px;">
                Belohnung: ü™ô {lesson['reward']} Robux
            </p>

            <div style="background: rgba(0, 162, 255, 0.1); border-left: 4px solid #00a2ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="color: #00a2ff; margin: 0 0 10px 0; font-size: 16px;">üìù Deine Aufgabe:</h3>
                <p style="color: #ffffff; margin: 0; line-height: 1.6;">{lesson['task']}</p>
            </div>

            <div class="hint-box" id="hintBox">
                <h4>üí° Hinweis:</h4>
                <p>{lesson['hint']}</p>
            </div>

            <h3 style="color: #00a2ff; margin: 20px 0 10px 0;">üíª Code-Editor:</h3>
            <textarea class="code-editor" id="codeEditor">{lesson['starter']}</textarea>

            <div class="editor-buttons">
                <button class="editor-btn" onclick="runCode()">‚ñ∂Ô∏è Ausf√ºhren (F5)</button>
                <button class="editor-btn submit" onclick="checkSolution()">‚úÖ L√∂sung pr√ºfen</button>
                <button class="editor-btn" onclick="toggleHint()">üí° Hinweis</button>
                <button class="editor-btn" onclick="resetCode()">üîÑ Zur√ºcksetzen</button>
            </div>

            <h3 style="color: #00a2ff; margin: 20px 0 10px 0;">üìü Ausgabe:</h3>
            <div class="output-panel" id="output">Keine Ausgabe</div>

            <div class="feedback-box" id="feedback"></div>
        </div>
    '''
    
    document['contentArea'].html = content
    
    # Aktive Lektion markieren
    for item in document.select('.lesson-item'):
        item.classList.remove('active')
    try:
        document[f'lesson_{lesson_id}'].classList.add('active')
    except:
        pass

def run_code():
    code = document['codeEditor'].value
    output_div = document['output']
    
    old_stdout = sys.stdout
    sys.stdout = StringIO()
    
    try:
        exec(code)
        output = sys.stdout.getvalue()
        if output:
            output_div.html = output
            output_div.classList.remove('output-error')
        else:
            output_div.html = 'Keine Ausgabe'
    except Exception as e:
        error_msg = f"‚ùå Fehler: {str(e)}"
        output_div.html = error_msg
        output_div.classList.add('output-error')
    finally:
        sys.stdout = old_stdout

def check_solution():
    import random
    lesson = LESSONS[current_lesson]
    code = document['codeEditor'].value

    # F√ºhre Code aus f√ºr Output
    old_stdout = sys.stdout
    sys.stdout = StringIO()
    try:
        exec(code)
        output = sys.stdout.getvalue()
    except:
        output = ""
    finally:
        sys.stdout = old_stdout

    # Pr√ºfe L√∂sung
    try:
        is_correct = lesson['check'](code, output)
    except:
        is_correct = len(code.strip()) > 10

    feedback_div = document['feedback']

    if is_correct:
        if current_lesson not in player_data['completed']:
            player_data['completed'].add(current_lesson)
            add_robux(lesson['reward'])

            # Zeige Roblox-Figur mit kluger Aussage
            smart_quote = random.choice(SMART_QUOTES)
            show_success_character(smart_quote, lesson['reward'])

            # Level basierend auf abgeschlossenen Lektionen aktualisieren
            completed_count = len(player_data['completed'])
            new_level = (completed_count // 3) + 1
            if new_level > player_data['level']:
                player_data['level'] = new_level
                document['playerLevel'].text = str(new_level)

            # N√§chste Lektion freischalten (Escape Room System)
            next_lesson_id = get_next_lesson_id(current_lesson)
            if next_lesson_id:
                unlock_lesson(next_lesson_id)
                # Zeige Maskottchen mit motivierender Nachricht
                mascot_message = random.choice(MASCOT_MESSAGES)
                window.setTimeout(lambda: show_mascot(mascot_message, "üéÆ"), 5500)
            else:
                # Spezielle Nachricht beim Abschluss aller Lektionen
                window.setTimeout(lambda: show_mascot("üèÜ HERZLICHEN GL√úCKWUNSCH! Du hast ALLE Lektionen abgeschlossen! Du bist ein Python-Meister! üêç", "üëë"), 5500)

            feedback_div.className = 'feedback-box success'
            feedback_div.html = f'''
                <div style="font-weight: 700; font-size: 16px; margin-bottom: 8px;">
                    üéâ Perfekt gel√∂st!
                </div>
                <div>Du hast {lesson['reward']} Robux verdient!</div>
            '''

            # Lektions-Icons aktualisieren
            update_lesson_icons()
        else:
            feedback_div.className = 'feedback-box success'
            feedback_div.html = '<div style="font-weight: 700;">‚úÖ Richtig!</div>'
    else:
        feedback_div.className = 'feedback-box error'
        feedback_div.html = '''
            <div style="font-weight: 700; margin-bottom: 8px;">‚ùå Noch nicht ganz</div>
            <div>Versuch es nochmal! Lies die Aufgabe genau.</div>
        '''

    feedback_div.style.display = 'block'

def reset_code():
    lesson = LESSONS[current_lesson]
    document['codeEditor'].value = lesson['starter']
    document['output'].html = 'Keine Ausgabe'
    document['feedback'].style.display = 'none'

def init():
    # Erstelle Lektionsliste
    worlds = {1: 'üå± Welt 1: Anf√§nger', 2: 'üî• Welt 2: Fortgeschritten', 3: 'üöÄ Welt 3: Profi'}
    lesson_list = document['lessonList']

    current_world = 0
    for lesson_id, lesson in LESSONS.items():
        if lesson['world'] != current_world:
            current_world = lesson['world']
            world_header = html.DIV(worlds[current_world], Class='panel-header')
            lesson_list <= world_header

        # Lektionselement mit Titel und Platz f√ºr Icon erstellen
        lesson_title = html.SPAN(lesson['title'], Class='lesson-title-text')
        lesson_item = html.DIV(Class='lesson-item', id=f'lesson_{lesson_id}')
        lesson_item <= lesson_title

        # Schloss hinzuf√ºgen wenn gesperrt
        if lesson_id not in player_data['unlocked']:
            lesson_item.classList.add('locked')
            lock_icon = html.SPAN('üîí', Class='lesson-lock')
            lesson_item <= lock_icon

        lesson_item.bind('click', lambda e, lid=lesson_id: load_lesson(lid))
        lesson_list <= lesson_item

    # Lade erste Lektion
    load_lesson('lesson1')

# Keyboard shortcuts
def handle_keydown(event):
    if event.key == 'F5':
        event.preventDefault()
        run_code()
    elif event.ctrlKey and event.key == 'Enter':
        event.preventDefault()
        check_solution()

document.bind('keydown', handle_keydown)

# Globale Funktionen
window.runCode = run_code
window.checkSolution = check_solution
window.resetCode = reset_code
window.hideMascot = hide_mascot
window.toggleHint = toggle_hint

# Initialisiere
init()

# Willkommens-Nachricht
show_mascot("üéÆ Willkommen bei deinem Python-Abenteuer! L√∂se jede Lektion um die n√§chste freizuschalten. Wie ein Escape Room! üîì", "üéØ")
    </script>
</body>
</html>
